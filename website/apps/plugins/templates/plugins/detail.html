{% extends "layout/main.html" %}

{% load comments %}

{% block content %}
  <a href="{% url "plugins:list" %}">Back to plugin list</a>
  <h1>Plugin detail : {{ object.name }}</h1>
  <p>
    {{ release.description }}
  </p>
  <hr />
  <p>Number of download : {{ object.nb_download }}</p>
  <p>
    Number of upvote : {{ object.nb_upvote }}
    {% if user.is_authenticated %}
      {% if user_has_upvoted %}
        <a href="{% url 'plugins:downvote' username=object.author.username plugin_name=object.name %}">Downvote</a>
      {% else %}
        <a href="{% url 'plugins:upvote' username=object.author.username plugin_name=object.name %}">Upvote</a>
      {% endif %}
    {% endif %}
  </p>
  <h3>List of releases :</h3>
  <ul>
    {% for release in object.release_set.all %}
      <li>{{ release.version }}</li>
    {% endfor %}
  </ul>
  <h3>Tags:</h3>
  <ul>
    {% for tag in release.tags.names %}
      <li>{{ tag }}</li>
    {% endfor %}
  </ul>
  <h3>Comments :</h3>

  {% if user.is_authenticated %}
      {% get_comment_form for object as form %}
      <form action="{% comment_form_target %}" method="POST">
      {% csrf_token %}
      {{ form.comment }}
      {{ form.honeypot }}
      {{ form.content_type }}
      {{ form.object_pk }}
      {{ form.timestamp }}
      {{ form.security_hash }}
      <input type="hidden" name="next" value="{{ object.url }}" />
      <input type="submit" value="Add comment" id="id_submit" />
      </form>
  {% else %}
      <p>Please <a href="{% url 'user:login' %}">log in</a> to leave a comment.</p>
  {% endif %}

  <ul>
    {% get_comment_list for object as comment_list %}
    {% for comment in comment_list %}
      <li>{{ comment }}</li>
    {% endfor %}
  </ul>
{% endblock %}
